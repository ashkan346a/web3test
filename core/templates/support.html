{% extends 'base.html' %}
<!-- Cache Bust: 20250911153118 -->
{% load static %}
{% block title %}پشتیبانی — PharmaWeb{% endblock %}
{% block description %}پشتیبانی ۲۴/۷ PharmaWeb — راهنمایی خرید، پیگیری سفارش و پاسخ به سوالات شما.{% endblock %}
{% block canonical_url %}{{ SITE_URL }}/support/{% endblock %}

{% block extra_css %}
<style>
:root {
  --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --secondary-gradient: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
  --success-gradient: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
  --info-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --warning-gradient: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
  --danger-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
  --glassmorphism-bg: rgba(255, 255, 255, 0.95);
  --glassmorphism-border: rgba(255, 255, 255, 0.8);
  --shadow-light: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
  --shadow-hover: 0 15px 35px 0 rgba(31, 38, 135, 0.2);
  --border-radius-lg: 24px;
  --border-radius-xl: 32px;
}

body {
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  min-height: 100vh;
}

.support-hero {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 4rem 0;
  margin-bottom: 3rem;
  position: relative;
  overflow: hidden;
}

.support-hero::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="white" opacity="0.1"><polygon points="0,0 1000,100 1000,0"/></svg>');
  background-size: cover;
  pointer-events: none;
}

.support-hero .container {
  position: relative;
  z-index: 1;
}

.support-card {
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-radius: var(--border-radius-xl);
  border: 1px solid rgba(255, 255, 255, 0.9);
  box-shadow: var(--shadow-light);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  overflow: hidden;
  position: relative;
}

.support-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--primary-gradient);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.support-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: var(--shadow-hover);
}

.support-card:hover::before {
  transform: scaleX(1);
}

.contact-icon {
  width: 64px;
  height: 64px;
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: white;
  position: relative;
  overflow: hidden;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.contact-icon::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
  transition: opacity 0.3s ease;
  opacity: 0;
}

.contact-icon:hover::before {
  opacity: 1;
}

.contact-item {
  padding: 2rem;
  border-radius: var(--border-radius-lg);
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.8);
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  margin-bottom: 1.5rem;
  position: relative;
  overflow: hidden;
}

.contact-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  transition: left 0.5s ease;
}

.contact-item:hover {
  transform: translateY(-5px) translateX(-8px);
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  background: rgba(255, 255, 255, 1);
}

.contact-item:hover::before {
  left: 100%;
}

.contact-item:hover .contact-icon {
  transform: scale(1.1) rotate(5deg);
}

.form-control, .form-select {
  border-radius: 16px;
  border: 2px solid rgba(255, 255, 255, 0.9);
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(5px);
  padding: 1rem 1.25rem;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  font-size: 1rem;
  color: #2d3748;
}

.form-control:focus, .form-select:focus {
  border-color: rgba(102, 126, 234, 0.8);
  box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.15), 0 8px 16px rgba(102, 126, 234, 0.1);
  transform: translateY(-2px);
  background: rgba(255, 255, 255, 1);
  color: #2d3748;
}

.form-label {
  font-weight: 600;
  color: #2d3748;
  margin-bottom: 0.75rem;
  font-size: 0.95rem;
  text-shadow: none;
}

.btn-primary {
  background: var(--primary-gradient);
  border: none;
  border-radius: 16px;
  padding: 1rem 2.5rem;
  font-weight: 700;
  font-size: 1.1rem;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  overflow: hidden;
}

.btn-primary::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s ease;
}

.btn-primary:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
}

.btn-primary:hover::before {
  left: 100%;
}

.btn-outline-secondary, .btn-outline-primary, .btn-outline-info, .btn-outline-danger {
  border: 2px solid;
  border-radius: 12px;
  padding: 0.5rem 1.25rem;
  font-weight: 600;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  overflow: hidden;
}

.btn-outline-secondary:hover, .btn-outline-primary:hover, 
.btn-outline-info:hover, .btn-outline-danger:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.ticket-item {
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(5px);
  border-radius: var(--border-radius-lg);
  padding: 2rem;
  margin-bottom: 1.5rem;
  border-left: 6px solid;
  border-image: var(--primary-gradient) 1;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  animation: slideInRight 0.6s ease;
  position: relative;
  overflow: hidden;
}

.ticket-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.ticket-item:hover {
  transform: translateY(-8px) translateX(-10px);
  box-shadow: 0 25px 50px rgba(0,0,0,0.15);
  border-left-width: 8px;
  background: rgba(255, 255, 255, 1);
}

.ticket-item:hover::before {
  opacity: 0;
}

.status-badge {
  padding: 0.75rem 1.5rem;
  border-radius: 25px;
  font-size: 0.85rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.status-badge::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  transition: left 0.5s ease;
}

.status-badge:hover::before {
  left: 100%;
}

.status-pending { 
  background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
  color: #856404;
  box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
}

.status-in-progress { 
  background: linear-gradient(135deg, #cff4fc 0%, #9fddff 100%);
  color: #055160;
  box-shadow: 0 4px 15px rgba(13, 202, 240, 0.3);
}

.status-resolved { 
  background: linear-gradient(135deg, #d1edff 0%, #a8e6cf 100%);
  color: #0a58ca;
  box-shadow: 0 4px 15px rgba(25, 135, 84, 0.3);
}

.status-closed { 
  background: linear-gradient(135deg, #f8d7da 0%, #ffb3ba 100%);
  color: #721c24;
  box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
}

.accordion-button {
  border-radius: 16px !important;
  background: rgba(255, 255, 255, 0.98) !important;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.9) !important;
  font-weight: 700;
  padding: 1.5rem 2rem;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  position: relative;
  overflow: hidden;
  color: #2d3748 !important;
}

.accordion-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.5s ease;
}

.accordion-button:not(.collapsed) {
  background: var(--primary-gradient);
  color: white;
  transform: scale(1.02);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.accordion-button:hover::before {
  left: 100%;
}

.accordion-item {
  background: rgba(255, 255, 255, 0.98) !important;
  backdrop-filter: blur(5px);
  border-radius: 16px;
  border: 1px solid rgba(255, 255, 255, 0.9) !important;
  margin-bottom: 1rem;
  overflow: hidden;
}

.floating-animation {
  animation: floating 4s ease-in-out infinite;
}

@keyframes floating {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  33% { transform: translateY(-12px) rotate(2deg); }
  66% { transform: translateY(-8px) rotate(-1deg); }
}

@keyframes slideInRight {
  from { 
    opacity: 0; 
    transform: translateX(50px) scale(0.9); 
  }
  to { 
    opacity: 1; 
    transform: translateX(0) scale(1); 
  }
}

@keyframes fadeInUp {
  from { 
    opacity: 0; 
    transform: translateY(40px) scale(0.95); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0) scale(1); 
  }
}

.fade-in-up {
  animation: fadeInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.pulse-animation {
  animation: pulse 3s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
  70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
}

/* Responsive Design */
@media (max-width: 1200px) {
  .support-hero { padding: 3rem 0; }
  .container { padding: 0 1.5rem; }
  .contact-item { padding: 1.5rem; }
  .ticket-item { padding: 1.5rem; }
}

@media (max-width: 768px) {
  .support-hero { 
    padding: 2.5rem 0; 
    margin-bottom: 2rem; 
  }
  
  .support-hero h1 { 
    font-size: 2.5rem !important; 
  }
  
  .support-hero .lead { 
    font-size: 1.1rem; 
  }
  
  .container { padding: 0 1rem; }
  
  .contact-item { 
    margin-bottom: 1rem; 
    padding: 1.25rem;
  }
  
  .contact-icon {
    width: 56px;
    height: 56px;
    font-size: 1.3rem;
  }
  
  .support-card {
    margin-bottom: 1.5rem;
  }
  
  .form-control, .form-select {
    padding: 0.875rem 1rem;
    font-size: 0.95rem;
  }
  
  .btn-primary {
    padding: 0.875rem 2rem;
    font-size: 1rem;
  }
  
  .ticket-item {
    padding: 1.25rem;
    margin-bottom: 1.25rem;
  }
  
  .status-badge {
    padding: 0.625rem 1.25rem;
    font-size: 0.8rem;
  }
  
  .accordion-button {
    padding: 1.25rem 1.5rem;
    font-size: 0.95rem;
  }
}

@media (max-width: 576px) {
  .support-hero h1 { 
    font-size: 2rem !important; 
  }
  
  .support-hero .btn {
    margin: 0.25rem;
    padding: 0.75rem 1.5rem;
    font-size: 0.9rem;
  }
  
  .contact-item {
    padding: 1rem;
    text-align: center;
  }
  
  .contact-item .d-flex {
    flex-direction: column;
    gap: 1rem !important;
  }
  
  .form-control, .form-select {
    padding: 0.75rem;
  }
  
  .btn-primary {
    width: 100%;
    margin-bottom: 0.75rem;
  }
  
  .ticket-item {
    padding: 1rem;
  }
  
  .ticket-item .d-flex {
    flex-direction: column;
    gap: 1rem;
  }
  
  .status-badge {
    align-self: flex-start;
    margin-top: 0.5rem;
  }
}

/* Success/Error alerts styling */
.alert-custom {
  border-radius: var(--border-radius-lg);
  border: none;
  padding: 2rem;
  margin: 1.5rem 0;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.alert-custom::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: var(--primary-gradient);
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

.alert-success.alert-custom {
  background: rgba(212, 237, 218, 0.98) !important;
  color: #0f5132 !important;
  border: 1px solid rgba(25, 135, 84, 0.5) !important;
}

.alert-danger.alert-custom {
  background: rgba(248, 215, 218, 0.98) !important;
  color: #721c24 !important;
  border: 1px solid rgba(220, 53, 69, 0.5) !important;
}

.alert-warning.alert-custom {
  background: rgba(255, 243, 205, 0.98) !important;
  color: #856404 !important;
  border: 1px solid rgba(255, 193, 7, 0.5) !important;
}

.alert-info.alert-custom {
  background: rgba(207, 244, 252, 0.98) !important;
  color: #055160 !important;
  border: 1px solid rgba(13, 202, 240, 0.5) !important;
}

.loading-spinner {
  display: inline-block;
  width: 24px;
  height: 24px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Enhanced File upload styling */
.file-upload-wrapper {
  position: relative;
  overflow: hidden;
  border-radius: var(--border-radius-lg);
  border: 2px dashed rgba(102, 126, 234, 0.5);
  background: rgba(255, 255, 255, 0.98);
  backdrop-filter: blur(5px);
  padding: 2rem;
  text-align: center;
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  cursor: pointer;
}

.file-upload-wrapper:hover {
  border-color: rgba(102, 126, 234, 0.8);
  background: rgba(255, 255, 255, 1);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
}

.file-upload-wrapper input[type=file] {
  position: absolute;
  left: -9999px;
}

/* Enhanced Hero Buttons */
.btn-light {
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  color: #667eea;
  font-weight: 700;
  border-radius: 16px;
  padding: 1rem 2rem;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.btn-light:hover {
  background: rgba(255, 255, 255, 1);
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  color: #667eea;
}

.btn-outline-light {
  border: 2px solid rgba(255, 255, 255, 0.8);
  background: transparent;
  color: white;
  font-weight: 700;
  border-radius: 16px;
  padding: 1rem 2rem;
  transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.btn-outline-light:hover {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
  color: white;
  border-color: white;
}

/* Enhanced Typography */
h1, h2, h3, h4, h5, h6 {
  font-weight: 800;
  letter-spacing: -0.5px;
  color: #2d3748 !important;
  text-shadow: none !important;
}

.display-4 {
  font-weight: 900;
  text-shadow: 0 2px 4px rgba(0,0,0,0.1);
  color: white !important;
}

.lead {
  font-weight: 500;
  letter-spacing: 0.3px;
  line-height: 1.7;
  color: rgba(255, 255, 255, 0.95) !important;
}

/* Text color fixes */
.text-dark {
  color: #2d3748 !important;
}

.text-muted {
  color: #718096 !important;
}

.text-primary {
  color: #667eea !important;
}

/* Card text improvements */
.card-body h5,
.card-body h6 {
  color: #2d3748 !important;
}

.card-body p {
  color: #4a5568 !important;
}

.card-body small {
  color: #718096 !important;
}

/* Scroll Animation Trigger */
.animate-on-scroll {
  opacity: 0;
  transform: translateY(30px);
  transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

.animate-on-scroll.animate {
  opacity: 1;
  transform: translateY(0);
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.1);
}

::-webkit-scrollbar-thumb {
  background: var(--primary-gradient);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, #5a67d8 0%, #667eea 100%);
}
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="support-hero">
  <div class="container text-center">
    <div class="row align-items-center">
      <div class="col-md-10 col-lg-8 mx-auto">
        <h1 class="display-4 fw-bold mb-4 fade-in-up">
          <i class="fas fa-headset me-3 floating-animation"></i>
          پشتیبانی PharmaWeb
        </h1>
        <p class="lead mb-5 fade-in-up" style="animation-delay: 0.2s;">
          ما اینجا هستیم تا سریع و حرفه‌ای به شما کمک کنیم — هر سؤالی دارید ارسال کنید
        </p>
        <div class="d-flex flex-wrap justify-content-center gap-3 fade-in-up" style="animation-delay: 0.4s;">
          <a href="{% url 'buy_medicine' %}" class="btn btn-light btn-lg">
            <i class="fas fa-pills me-2"></i>بازگشت به فروشگاه
          </a>
          <a href="#contact-form" class="btn btn-outline-light btn-lg">
            <i class="fas fa-paper-plane me-2"></i>ثبت درخواست
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container my-5" dir="rtl">
  <div class="row g-4">
    <!-- Contact Information -->
    <div class="col-lg-4">
      <div class="support-card h-100 fade-in-up animate-on-scroll">
        <div class="card-body p-4">
          <h5 class="fw-bold mb-4 text-center text-primary">
            <i class="fas fa-phone-alt me-2"></i>
            راه‌های ارتباطی
          </h5>

          <div class="contact-item animate-on-scroll">
            <div class="d-flex align-items-center gap-3">
              <div class="contact-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <i class="fas fa-headset"></i>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-2 fw-bold text-dark">پشتیبانی واتساپ</h6>
                <p class="text-muted small mb-2">شنبه تا پنج‌شنبه 9:00–18:00</p>
                <a href="tel:+989915022377" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-phone me-1"></i>+989915022377
                </a>
              </div>
            </div>
          </div>

          <div class="contact-item animate-on-scroll">
            <div class="d-flex align-items-center gap-3">
              <div class="contact-icon" style="background: linear-gradient(135deg, #36d1dc 0%, #5b86e5 100%);">
                <i class="fab fa-telegram"></i>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-2 fw-bold text-dark">کانال تلگرام</h6>
                <p class="text-muted small mb-2">پاسخ سریع و ارسال عکس/نسخه</p>
                <a href="https://t.me/PharmaWebAD" target="_blank" class="btn btn-sm btn-outline-info">
                  <i class="fab fa-telegram me-1"></i>@PharmaWebAD
                </a>
              </div>
            </div>
          </div>

          <div class="contact-item animate-on-scroll">
            <div class="d-flex align-items-center gap-3">
              <div class="contact-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <i class="fas fa-envelope"></i>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-2 fw-bold text-dark">ایمیل</h6>
                <p class="text-muted small mb-2">برای مستندات و گزارشات</p>
                <a href="mailto:support@pharmaweb.example" class="btn btn-sm btn-outline-danger">
                  <i class="fas fa-envelope me-1"></i>ایمیل پشتیبانی
                </a>
              </div>
            </div>
          </div>

          <div class="alert alert-info alert-custom mt-4 animate-on-scroll">
            <div class="d-flex align-items-start">
              <i class="fas fa-info-circle fa-lg me-3 mt-1"></i>
              <div>
                <strong>نکته مهم:</strong> لطفاً برای مسائل پزشکی حساس، شماره سفارش و تصاویر بسته‌بندی یا نسخه را ضمیمه کنید تا سریع‌تر بررسی شود.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Support Form -->
    <div class="col-lg-8">
      <div class="support-card fade-in-up animate-on-scroll" id="contact-form" style="animation-delay: 0.2s;">
        <div class="card-body p-5">
          <h5 class="fw-bold mb-4 text-center text-primary">
            <i class="fas fa-paper-plane me-2"></i>
            ارسال درخواست به پشتیبانی
          </h5>

          <form id="supportForm" method="post" action="{% url 'support' %}" enctype="multipart/form-data" novalidate>
            {% csrf_token %}
            <div class="row g-4">
              <div class="col-md-6">
                <label class="form-label fw-semibold text-primary">
                  <i class="fas fa-user me-2"></i>نام و نام خانوادگی
                </label>
                <input name="name" type="text" class="form-control animate-on-scroll" placeholder="مثال: علی رضایی" required 
                       value="{% if user.is_authenticated %}{{ user.first_name }} {{ user.last_name }}{% endif %}">
                <div class="invalid-feedback">
                  لطفاً نام و نام خانوادگی خود را وارد کنید.
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label fw-semibold text-primary">
                  <i class="fas fa-phone me-2"></i>ایمیل یا تلفن
                </label>
                <input name="contact" type="text" class="form-control animate-on-scroll" placeholder="ایمیل یا شماره تماس" required
                       value="{% if user.is_authenticated %}{{ user.phone }}{% endif %}">
                <div class="invalid-feedback">
                  لطفاً اطلاعات تماس خود را وارد کنید.
                </div>
              </div>

              <div class="col-12">
                <label class="form-label fw-semibold text-primary">
                  <i class="fas fa-tag me-2"></i>موضوع
                </label>
                <input name="subject" type="text" class="form-control animate-on-scroll" placeholder="موضوع درخواست" required>
                <div class="invalid-feedback">
                  لطفاً موضوع درخواست خود را وارد کنید.
                </div>
              </div>

              <div class="col-12">
                <label class="form-label fw-semibold text-primary">
                  <i class="fas fa-comment-alt me-2"></i>توضیحات
                </label>
                <textarea name="message" rows="6" class="form-control animate-on-scroll" placeholder="توضیحات کامل مشکل یا سوال خود را بنویسید..." required></textarea>
                <div class="invalid-feedback">
                  لطفاً توضیحات درخواست خود را وارد کنید.
                </div>
              </div>

              <div class="col-md-8">
                <label class="form-label fw-semibold text-primary">
                  <i class="fas fa-paperclip me-2"></i>ضمیمه (تصویر نسخه یا بسته‌بندی)
                </label>
                <div class="file-upload-wrapper animate-on-scroll" onclick="document.getElementById('file-input').click();">
                  <input id="file-input" name="attachment" type="file" accept="image/*,.pdf">
                  <div id="file-display">
                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3 floating-animation"></i>
                    <p class="mb-1 text-muted fw-semibold">کلیک کنید یا فایل را بکشید</p>
                    <small class="text-muted">حداکثر 5MB • تصاویر و PDF (اختیاری)</small>
                  </div>
                </div>
              </div>

              <div class="col-md-4 d-flex align-items-end">
                <div class="d-grid w-100 gap-3 animate-on-scroll">
                  <button type="submit" class="btn btn-primary btn-lg pulse-animation">
                    <i class="fas fa-paper-plane me-2"></i>ارسال درخواست
                  </button>
                  <button type="reset" class="btn btn-outline-secondary">
                    <i class="fas fa-redo me-2"></i>پاک کردن
                  </button>
                </div>
              </div>
            </div>
          </form>

          <div id="supportAlert" class="d-none mt-4" role="alert"></div>
        </div>
      </div>

      <!-- User Tickets History -->
      {% if user.is_authenticated and user_tickets %}
      <div class="support-card mt-4 fade-in-up animate-on-scroll" style="animation-delay: 0.4s;" id="user-tickets">
        <div class="card-body p-5">
          <h5 class="fw-bold mb-4 text-primary">
            <i class="fas fa-history me-2"></i>
            درخواست‌های اخیر شما
            <span class="badge bg-primary ms-2">{{ user_tickets.count }}</span>
          </h5>
          
          <div class="tickets-list">
            {% for ticket in user_tickets %}
            <div class="ticket-item animate-on-scroll" style="animation-delay: {{ forloop.counter|floatformat:1 }}00ms;">
              <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start gap-3">
                <div class="flex-grow-1">
                  <div class="d-flex align-items-start gap-3 mb-3">
                    <div class="flex-shrink-0">
                      <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" style="width: 48px; height: 48px;">
                        <i class="fas fa-ticket-alt"></i>
                      </div>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="mb-2 fw-bold text-primary">{{ ticket.subject }}</h6>
                      <p class="text-muted mb-2 lh-base">{{ ticket.message|truncatechars:120 }}</p>
                      <div class="d-flex flex-wrap align-items-center gap-3">
                        <small class="text-muted d-flex align-items-center">
                          <i class="fas fa-calendar me-2"></i>{{ ticket.created_at|date:"j F Y - H:i" }}
                        </small>
                        {% if ticket.attachment %}
                        <small class="text-success d-flex align-items-center">
                          <i class="fas fa-paperclip me-2"></i>دارای ضمیمه
                        </small>
                        {% endif %}
                        <small class="text-primary d-flex align-items-center">
                          <i class="fas fa-hashtag me-1"></i>{{ ticket.ticket_id|slice:":8" }}...
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="text-end">
                  <span class="status-badge status-{{ ticket.status|lower }} mb-3">
                    {% if ticket.status == 'PENDING' %}
                      <i class="fas fa-clock me-2"></i>در حال بررسی
                    {% elif ticket.status == 'IN_PROGRESS' %}
                      <i class="fas fa-cog fa-spin me-2"></i>در حال پیگیری
                    {% elif ticket.status == 'RESOLVED' %}
                      <i class="fas fa-check-circle me-2"></i>حل شده
                    {% elif ticket.status == 'CLOSED' %}
                      <i class="fas fa-times-circle me-2"></i>بسته شده
                    {% endif %}
                  </span>
                  
                  {% if ticket.admin_response %}
                  <div class="mt-3">
                    <button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#response-{{ ticket.id }}" aria-expanded="false">
                      <i class="fas fa-comment-dots me-2"></i>مشاهده پاسخ
                    </button>
                  </div>
                  {% endif %}
                </div>
              </div>
              
              {% if ticket.admin_response %}
              <div class="collapse mt-4" id="response-{{ ticket.id }}">
                <div class="alert alert-success alert-custom">
                  <div class="d-flex align-items-start gap-3">
                    <div class="flex-shrink-0">
                      <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                        <i class="fas fa-user-tie"></i>
                      </div>
                    </div>
                    <div class="flex-grow-1">
                      <h6 class="fw-bold mb-2 text-success">
                        پاسخ تیم پشتیبانی:
                      </h6>
                      <p class="mb-0 lh-base">{{ ticket.admin_response }}</p>
                      {% if ticket.resolved_at %}
                      <small class="text-muted d-block mt-3 pt-3 border-top">
                        <i class="fas fa-check-circle me-2"></i>تاریخ حل شدن: {{ ticket.resolved_at|date:"j F Y - H:i" }}
                      </small>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
          
          <div class="text-center mt-4">
            <small class="text-muted">
              <i class="fas fa-info-circle me-2"></i>
              برای مشاهده تمام درخواست‌های خود با پشتیبانی تماس بگیرید
            </small>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- FAQ Section -->
      <div class="support-card mt-4 fade-in-up animate-on-scroll" style="animation-delay: 0.6s;">
        <div class="card-body p-5">
          <h5 class="fw-bold mb-4 text-primary">
            <i class="fas fa-question-circle me-2"></i>
            سؤالات متداول
          </h5>
          
          <div class="accordion" id="supportFAQ">
            <div class="accordion-item animate-on-scroll">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                  <i class="fas fa-shipping-fast me-3"></i>
                  چگونه رسید سفارش را پیگیری کنم؟
                </button>
              </h2>
              <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#supportFAQ">
                <div class="accordion-body">
                  <div class="d-flex align-items-start gap-3">
                    <i class="fas fa-lightbulb fa-lg text-warning mt-1"></i>
                    <div>
                      وارد حساب کاربری شوید و به بخش «سفارش‌ها» بروید؛ وضعیت و اطلاعات پیگیری برای هر سفارش نمایش داده می‌شود. همچنین می‌توانید کد رهگیری را در سایت پست جستجو کنید.
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="accordion-item animate-on-scroll">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                  <i class="fas fa-comments me-3"></i>
                  چه مواردی را در پیام بفرستم تا سریع‌تر پاسخ بگیرم؟
                </button>
              </h2>
              <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#supportFAQ">
                <div class="accordion-body">
                  <div class="d-flex align-items-start gap-3">
                    <i class="fas fa-lightbulb fa-lg text-warning mt-1"></i>
                    <div>
                      شماره سفارش، تصویر بسته‌بندی یا نسخه، تاریخ خرید و توضیح کامل مشکل را ارسال کنید. هرچه اطلاعات بیشتری ارائه دهید، سریع‌تر پاسخ دریافت می‌کنید.
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="accordion-item animate-on-scroll">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                  <i class="fas fa-clock me-3"></i>
                  چند وقت طول می‌کشد تا پاسخ بگیرم؟
                </button>
              </h2>
              <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#supportFAQ">
                <div class="accordion-body">
                  <div class="d-flex align-items-start gap-3">
                    <i class="fas fa-lightbulb fa-lg text-warning mt-1"></i>
                    <div>
                      معمولاً ظرف 2-4 ساعت در روزهای کاری پاسخ دریافت می‌کنید. برای مسائل فوری از کانال تلگرام استفاده کنید که 24 ساعته فعال است.
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="accordion-item animate-on-scroll">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                  <i class="fas fa-shield-alt me-3"></i>
                  آیا اطلاعات من محفوظ است؟
                </button>
              </h2>
              <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#supportFAQ">
                <div class="accordion-body">
                  <div class="d-flex align-items-start gap-3">
                    <i class="fas fa-lightbulb fa-lg text-warning mt-1"></i>
                    <div>
                      بله، تمام اطلاعات شما با بالاترین استانداردهای امنیتی محافظت می‌شود و هیچگاه با اشخاص ثالث به اشتراک گذاشته نمی‌شود.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('supportForm');
  const alertEl = document.getElementById('supportAlert');
  const submitBtn = form?.querySelector('button[type="submit"]');
  const fileInput = document.getElementById('file-input');
  const fileDisplay = document.getElementById('file-display');
  
  // Enhanced File upload display with animations
  if (fileInput) {
    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      const wrapper = fileDisplay.parentElement;
      
      if (file) {
        // Add success animation
        wrapper.style.borderColor = 'rgba(25, 135, 84, 0.8)';
        wrapper.style.background = 'rgba(212, 237, 218, 0.98)';
        wrapper.style.color = '#0f5132';
        
        fileDisplay.innerHTML = `
          <div class="animate-on-scroll animate">
            <i class="fas fa-file-alt fa-3x text-success mb-3" style="animation: bounceIn 0.6s ease;"></i>
            <p class="mb-1 text-success fw-bold fs-5">${file.name}</p>
            <small class="text-muted fw-semibold">${(file.size / (1024*1024)).toFixed(2)} MB</small>
            <div class="mt-2">
              <span class="badge bg-success">آپلود موفق</span>
            </div>
          </div>
        `;
        
        // Add bounce animation
        wrapper.style.animation = 'bounce 0.6s ease';
        setTimeout(() => wrapper.style.animation = '', 600);
        
      } else {
        wrapper.style.borderColor = 'rgba(102, 126, 234, 0.5)';
        wrapper.style.background = 'rgba(255, 255, 255, 0.98)';
        wrapper.style.color = '#2d3748';
        
        fileDisplay.innerHTML = `
          <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3 floating-animation"></i>
          <p class="mb-1 text-muted fw-semibold">کلیک کنید یا فایل را بکشید</p>
          <small class="text-muted">حداکثر 5MB (اختیاری)</small>
        `;
      }
    });

    // Add drag and drop functionality
    const wrapper = fileDisplay.parentElement;
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      wrapper.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
      wrapper.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      wrapper.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
      wrapper.style.borderColor = 'rgba(102, 126, 234, 0.8)';
      wrapper.style.background = 'rgba(102, 126, 234, 0.1)';
      wrapper.style.transform = 'scale(1.02)';
      wrapper.style.color = '#2d3748';
    }

    function unhighlight(e) {
      wrapper.style.borderColor = 'rgba(102, 126, 234, 0.5)';
      wrapper.style.background = 'rgba(255, 255, 255, 0.98)';
      wrapper.style.transform = 'scale(1)';
      wrapper.style.color = '#2d3748';
    }

    wrapper.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      fileInput.files = files;
      
      // Trigger change event
      const event = new Event('change', { bubbles: true });
      fileInput.dispatchEvent(event);
    }
  }

  // Enhanced alert system with better animations
  function showAlert(type, message, timeout = 10000) {
    if (!alertEl) return;
    
    const iconMap = {
      'success': 'fas fa-check-circle',
      'danger': 'fas fa-exclamation-circle',
      'warning': 'fas fa-exclamation-triangle',
      'info': 'fas fa-info-circle'
    };
    
    alertEl.className = `alert alert-${type} alert-custom fade-in-up`;
    alertEl.innerHTML = `
      <div class="d-flex align-items-center">
        <i class="${iconMap[type]} fa-2x me-3" style="animation: pulse 2s infinite;"></i>
        <div>
          <strong class="fs-5">${message}</strong>
          <div class="progress mt-2" style="height: 3px;">
            <div class="progress-bar bg-white" role="progressbar" style="width: 100%; animation: shrink ${timeout/1000}s linear;"></div>
          </div>
        </div>
      </div>
    `;
    
    alertEl.classList.remove('d-none');
    
    // Add slide-in animation
    alertEl.style.transform = 'translateX(100%)';
    requestAnimationFrame(() => {
      alertEl.style.transition = 'transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
      alertEl.style.transform = 'translateX(0)';
    });
    
    if (timeout) {
      setTimeout(() => {
        alertEl.style.transform = 'translateX(100%)';
        setTimeout(() => {
          alertEl.classList.add('d-none');
          alertEl.style.transform = '';
          alertEl.style.transition = '';
        }, 500);
      }, timeout);
    }
  }

  if (!form) return;

  // Enhanced form submission with better UX
  form.addEventListener('submit', function (e) {
    e.preventDefault();

    // Client validation with enhanced feedback
    if (!form.checkValidity()) {
      form.classList.add('was-validated');
      
      // Highlight invalid fields with animation
      const invalidFields = form.querySelectorAll(':invalid');
      invalidFields.forEach(field => {
        field.style.animation = 'shake 0.5s ease-in-out';
        setTimeout(() => field.style.animation = '', 500);
      });
      
      showAlert('warning', 'لطفاً تمام فیلدهای اجباری را با دقت تکمیل کنید.');
      return;
    }

    // Enhanced loading state
    if (submitBtn) {
      submitBtn.disabled = true;
      submitBtn.innerHTML = `
        <span class="loading-spinner me-2"></span>
        <span>در حال ارسال...</span>
      `;
      submitBtn.classList.remove('pulse-animation');
      submitBtn.style.transform = 'scale(0.98)';
    }

    // Add loading overlay to form
    const overlay = document.createElement('div');
    overlay.className = 'position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center';
    overlay.style.background = 'rgba(255, 255, 255, 0.8)';
    overlay.style.backdropFilter = 'blur(5px)';
    overlay.style.zIndex = '1000';
    overlay.innerHTML = `
      <div class="text-center">
        <div class="loading-spinner mb-3" style="width: 3rem; height: 3rem; border-width: 4px;"></div>
        <p class="fw-bold text-primary">در حال پردازش درخواست شما...</p>
      </div>
    `;
    
    const formCard = form.closest('.support-card');
    formCard.style.position = 'relative';
    formCard.appendChild(overlay);

    // Send form data with better error handling
    const formData = new FormData(form);
    
    fetch(form.action, {
      method: 'POST',
      body: formData,
      headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }
      return response.json();
    })
    .then(data => {
      overlay.remove();
      
      if (data.success) {
        showAlert('success', data.message + ' 🎉');
        
        // Enhanced form reset with animation
        form.style.transition = 'opacity 0.3s ease';
        form.style.opacity = '0.5';
        
        setTimeout(() => {
          form.reset();
          form.classList.remove('was-validated');
          form.style.opacity = '1';
          
          // Reset file display with animation
          if (fileDisplay) {
            fileDisplay.innerHTML = `
              <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3 floating-animation"></i>
              <p class="mb-1 text-muted fw-semibold">کلیک کنید یا فایل را بکشید</p>
              <small class="text-muted">حداکثر 5MB (اختیاری)</small>
            `;
            fileDisplay.parentElement.style.borderColor = 'rgba(102, 126, 234, 0.5)';
            fileDisplay.parentElement.style.background = 'rgba(255, 255, 255, 0.98)';
            fileDisplay.parentElement.style.color = '#2d3748';
          }
        }, 300);
        
        // Reload to show new ticket if user is authenticated
        if (data.redirect_url) {
          setTimeout(() => {
            window.location.reload();
          }, 3000);
        }
      } else {
        showAlert('danger', data.message || 'خطا در ارسال درخواست');
      }
    })
    .catch(error => {
      overlay.remove();
      console.error('Error:', error);
      showAlert('danger', 'خطا در ارسال درخواست. لطفاً اتصال اینترنت خود را بررسی کنید.');
    })
    .finally(() => {
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>ارسال درخواست';
        submitBtn.classList.add('pulse-animation');
        submitBtn.style.transform = '';
      }
    });
  });

  // Enhanced smooth scrolling
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) {
        target.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start',
          inline: 'nearest'
        });
        
        // Add highlight effect to target
        target.style.animation = 'highlight 2s ease';
        setTimeout(() => target.style.animation = '', 2000);
      }
    });
  });

  // Enhanced scroll animations
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.style.animationPlayState = 'running';
        entry.target.classList.add('animate');
        
        // Stagger animations for multiple elements
        const siblings = entry.target.parentElement?.children;
        if (siblings) {
          Array.from(siblings).forEach((sibling, index) => {
            if (sibling !== entry.target) {
              setTimeout(() => {
                sibling.classList.add('animate');
              }, index * 100);
            }
          });
        }
      }
    });
  }, observerOptions);

  // Observe all animated elements
  document.querySelectorAll('.fade-in-up, .animate-on-scroll').forEach(el => {
    observer.observe(el);
  });

  // Add parallax effect to hero section
  window.addEventListener('scroll', () => {
    const scrolled = window.pageYOffset;
    const hero = document.querySelector('.support-hero');
    if (hero) {
      hero.style.transform = `translateY(${scrolled * 0.5}px)`;
    }
  });

  // Enhanced ticket interactions
  document.querySelectorAll('.ticket-item').forEach(ticket => {
    ticket.addEventListener('mouseenter', function() {
      this.style.borderLeftWidth = '8px';
      this.querySelector('.status-badge')?.classList.add('pulse-animation');
    });
    
    ticket.addEventListener('mouseleave', function() {
      this.style.borderLeftWidth = '6px';
      this.querySelector('.status-badge')?.classList.remove('pulse-animation');
    });
  });
});

// Add CSS animations for JavaScript effects
const style = document.createElement('style');
style.textContent = `
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
  }
  
  @keyframes bounceIn {
    0% { transform: scale(0) rotate(-360deg); opacity: 0; }
    50% { transform: scale(1.3) rotate(-180deg); }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
  }
  
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  
  @keyframes shrink {
    from { width: 100%; }
    to { width: 0%; }
  }
  
  @keyframes highlight {
    0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.5); }
    50% { box-shadow: 0 0 0 20px rgba(102, 126, 234, 0.1); }
    100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
  }
`;
document.head.appendChild(style);
</script>
{% endblock %}

<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ù†Ù…Ø§ÛŒØ´ Ù…Ø¨Ù„Øº Ú©Ø±ÛŒÙ¾ØªÙˆ</title>
    <style>
        body { font-family: Tahoma; direction: rtl; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .crypto-amount { font-weight: bold; color: #007cba; }
        .old-format { color: #999; text-decoration: line-through; }
        .new-format { color: #28a745; font-weight: bold; }
    </style>
</head>
<body>

<h1>ğŸª™ ØªØ³Øª Ù†Ù…Ø§ÛŒØ´ Ù…Ø¨Ù„Øº Ú©Ø±ÛŒÙ¾ØªÙˆ - ÙØ±Ù…Øª Ø¬Ø¯ÛŒØ¯</h1>

<div class="test-section">
    <h3>ğŸ“Š Ù…Ù‚Ø§ÛŒØ³Ù‡ ÙØ±Ù…Øª Ù‚Ø¯ÛŒÙ… Ùˆ Ø¬Ø¯ÛŒØ¯:</h3>
    
    <h4>ğŸŸ  Bitcoin (BTC):</h4>
    <p><span class="old-format">Ù‚Ø¯ÛŒÙ…: 0.00020865 BTC (8 Ø±Ù‚Ù…)</span></p>
    <p><span class="new-format">Ø¬Ø¯ÛŒØ¯: 0.000209 BTC (6 Ø±Ù‚Ù…)</span></p>
    
    <h4>ğŸ”· Ethereum (ETH):</h4>
    <p><span class="old-format">Ù‚Ø¯ÛŒÙ…: 0.00565287 ETH (6 Ø±Ù‚Ù…)</span></p>
    <p><span class="new-format">Ø¬Ø¯ÛŒØ¯: 0.0057 ETH (4 Ø±Ù‚Ù…)</span></p>
    
    <h4>ğŸ”´ Tron (TRX):</h4>
    <p><span class="old-format">Ù‚Ø¯ÛŒÙ…: 74.546363 TRX (6 Ø±Ù‚Ù…)</span></p>
    <p><span class="new-format">Ø¬Ø¯ÛŒØ¯: 74.5464 TRX (4 Ø±Ù‚Ù…)</span></p>
    
    <h4>ğŸŸ¢ USDT:</h4>
    <p><span class="old-format">Ù‚Ø¯ÛŒÙ…: 25.474525 USDT (6 Ø±Ù‚Ù…)</span></p>
    <p><span class="new-format">Ø¬Ø¯ÛŒØ¯: 25.4745 USDT (4 Ø±Ù‚Ù…)</span></p>
</div>

<div class="test-section">
    <h3>ğŸ”§ ØªØ³Øª ØªØ§Ø¨Ø¹ JavaScript:</h3>
    <div id="test-results"></div>
</div>

<script>
// Ú©Ù¾ÛŒ ØªØ§Ø¨Ø¹ Ø§Ø² checkout.html
function formatNumber(v, decimals = 4) { 
  if (v == null || v === undefined || isNaN(v)) return '0';
  
  const num = Number(v);
  let result = num.toFixed(decimals).replace(/\.0+$/, '');
  
  // Add thousand separators for better readability
  const parts = result.split('.');
  parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  
  return parts.join('.');
}

function formatCryptoAmount(amount, cryptoCode) {
  // Ø¨ÛŒØªÚ©ÙˆÛŒÙ†: 6 Ø±Ù‚Ù… Ø§Ø¹Ø´Ø§Ø±ØŒ Ø³Ø§ÛŒØ± Ø§Ø±Ø²Ù‡Ø§: 4 Ø±Ù‚Ù… Ø§Ø¹Ø´Ø§Ø±
  const decimals = cryptoCode === 'BTC' ? 6 : 4;
  return formatNumber(amount, decimals);
}

// ØªØ³Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆÙ†Ù‡
const testData = [
    { code: 'BTC', amount: 0.00020865, expected: '0.000209' },
    { code: 'ETH', amount: 0.00565287, expected: '0.0057' },
    { code: 'TRX', amount: 74.546363, expected: '74.5464' },
    { code: 'USDT', amount: 25.474525, expected: '25.4745' },
    { code: 'BNB', amount: 0.02142191, expected: '0.0214' },
    { code: 'SOL', amount: 0.10941388, expected: '0.1094' }
];

// Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª
let results = '<h4>Ù†ØªØ§ÛŒØ¬ ØªØ³Øª:</h4>';
let allPassed = true;

testData.forEach(test => {
    const result = formatCryptoAmount(test.amount, test.code);
    const passed = result === test.expected;
    const status = passed ? 'âœ…' : 'âŒ';
    
    if (!passed) allPassed = false;
    
    results += `<p>${status} ${test.code}: ${result} ${passed ? '(ØµØ­ÛŒØ­)' : `(Ø§Ù†ØªØ¸Ø§Ø±: ${test.expected})`}</p>`;
});

results += `<hr><p><strong>${allPassed ? 'ğŸ‰ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ Ù…ÙˆÙÙ‚!' : 'âš ï¸ Ø¨Ø±Ø®ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ù†Ø§Ù…ÙˆÙÙ‚'}</strong></p>`;

document.getElementById('test-results').innerHTML = results;

// Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒ
console.log('ğŸ§ª ØªØ³Øª formatCryptoAmount:');
testData.forEach(test => {
    const result = formatCryptoAmount(test.amount, test.code);
    console.log(`${test.code}: ${test.amount} â†’ ${result}`);
});
</script>

</body>
</html>